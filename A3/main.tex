\documentclass[a4paper, 11pt]{article}
\usepackage{mdframed}
\usepackage{comment} 
\usepackage{xparse}
\usepackage{tcolorbox}
\usepackage{lipsum} %This package just generates Lorem Ipsum filler text. 
\usepackage{fullpage} % changes the margin
\usepackage[a4paper, total={7in, 10in}]{geometry}
\usepackage[fleqn]{amsmath}
\usepackage{amssymb,amsthm}  % assumes amsmath package installed
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usepackage{verbatim}
\usepackage[numbered]{mcode}
\usepackage{float}
\usepackage{tikz}
    \usetikzlibrary{shapes,arrows}
    \usetikzlibrary{arrows,calc,positioning}

    \tikzset{
        block/.style = {draw, rectangle,
            minimum height=1cm,
            minimum width=1.5cm},
        input/.style = {coordinate,node distance=1cm},
        output/.style = {coordinate,node distance=4cm},
        arrow/.style={draw, -latex,node distance=2cm},
        pinstyle/.style = {pin edge={latex-, black,node distance=2cm}},
        sum/.style = {draw, circle, node distance=1cm},
    }
\usepackage{xcolor}
\usepackage{mdframed}
\usepackage[shortlabels]{enumitem}
\usepackage{indentfirst}
\usepackage{hyperref}
\usepackage[capitalize, nameinlink]{cleveref}
\renewcommand{\thesubsection}{\thesection.\alph{subsection}}

\newenvironment{problem}[2][Problem]
    { \begin{mdframed}[backgroundcolor=gray!20] \textbf{#1 #2} \\}
    {  \end{mdframed}}

\newenvironment{reduction}
    { \begin{mdframed}[backgroundcolor=blue!20] \\}
    {  \end{mdframed}}
% Define solution environment

\newcommand{\hr}{\noindent\rule{7in}{2.8pt}}
\newenvironment{solution}
    {\textit{Solution:}}
    {\clearpage}
\newcommand{\prob}[1]{\begin{mdframed}[backgroundcolor=gray!20] \textbf{Problem #1}\end{mdframed}}
\renewcommand{\qed}{\quad\qedsymbol}
\newcommand{\bit}{\left\{0, 1\right\}}
\newcommand{\ct}{\mathsf{ct}}
\newcommand{\hyb}{\mathsf{Hyb}}
\newcommand{\enc}{\mathsf{Enc}}
\newcommand{\enct}{\mathsf{Enc-two}}
\newcommand{\dec}{\mathsf{Dec}}
\newcommand{\dect}{\mathsf{Dec-two}}
\newcommand{\negl}{\mathsf{negl}}
\newcommand{\prf}{\mathsf{PRFAdv}}
\newcommand{\prg}{\mathsf{PRGAdv}}
\newcommand{\poly}{\mathsf{poly}}
\newcommand{\ord}{\mathsf{ord}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}

\newcommand{\calA}{\mathcal{A}}
\newcommand{\calB}{\mathcal{B}}
\newcommand{\calC}{\mathcal{C}}
\newcommand{\calE}{\mathcal{E}}
\newcommand{\calF}{\mathcal{F}}
\newcommand{\calG}{\mathcal{G}}
\newcommand{\calH}{\mathcal{H}}
\newcommand{\calK}{\mathcal{K}}
\newcommand{\calM}{\mathcal{M}}
\newcommand{\calS}{\mathcal{S}}
\newcommand{\calX}{\mathcal{X}}
\newcommand{\calY}{\mathcal{Y}}

\newcommand{\inparen}[1]{\left{ #1 \right}}
\newcommand{\probtwo}[2]{\mathsf{Pr}_{#1}\left[ #2 \right]}
\newcommand{\set}[1]{\left\{ #1 \right\}}
\newcommand{\twotimessadv}[1]{\mathsf{2SSAdv}\left[ #1 \right]}

\NewDocumentEnvironment{world}{ o }{%
  \begin{mdframed}[
    backgroundcolor=blue!10,
    innertopmargin=15pt,
    innerbottommargin=15pt,
    innerleftmargin=15pt,
    innerrightmargin=15pt,
  ]%
  \IfNoValueTF{#1}{%
    % If no title is provided
    \centering
  }{%
    % If a title is provided
    \centering\textbf{#1}\par
  }%
}{%
  \end{mdframed}%
}

\newlength{\protowidth}
\newcommand{\pprotocol}[5]{
{\begin{figure*}[#3]
\begin{center}
\setlength{\protowidth}{\textwidth}
\addtolength{\protowidth}{-3\intextsep}

\fbox{
        \small
        \hbox{\quad
        \begin{minipage}{\protowidth}
    \begin{center}
    {\bf #1}
    \end{center}
        #5
        \end{minipage}
        \quad}

        }
        
\end{center}
\vspace{-4ex}
\caption{{#4} #2}
\end{figure*}
} }

% the first arg is name of security game
% the second arg is caption
% the third arg is the game description
% the label needs to be included 
\newcommand{\securitygame}[4]{
   \pprotocol{#1}{#2}{ht!}{#3}{#4}
}

\newcommand{\constr}[4]{
   \pprotocol{#1}{#2}{tbh!}{#3}{#4}
}

\begin{document}

\newtheorem*{claim}[theorem]{Claim}
\newenvironment{fclaim}
{\colorlet{shadecolor}{red!20}\begin{shaded}\begin{claim}}
            {\end{claim}\end{shaded}}

\noindent
\large\textbf{Anish Banerjee, Shankh Gupta} \hfill \textbf{Problem Set - 3}   \\
\normalsize COL759: Cryptography \hfill October 2023\\
\hr


\prob{1: CPA with Very Weak Ciphertext Integrity}
\begin{solution}

\end{solution}


\prob{2 : Encryption Scheme with Threshold Decryption}
\begin{solution}
    Consider the following encryption scheme $\enct(k_i,k_j,m)$ defined as follows:
    $$\enct(k_i,k_j,m)=
        \begin{cases}
            \enc(k_2,\enc(k_1,m)) \hspace{50pt} k_i=1,k_j=2 \\
            \enc(k_2,\enc(k_3,m)) \hspace{50pt} k_i=2,k_j=3 \\
            \enc(k_3,\enc(k_4,m)) \hspace{50pt} k_i=3,k_j=4
        \end{cases}$$

    Similarly, we can define the decryption:
    $$\dect(k_i,k_j,\ct)=
        \begin{cases}
            \dec(k_1,\dec(k_2,\ct)) \hspace{50pt} k_i=1,k_j=2 \\
            \dec(k_3,\dec(k_2,\ct)) \hspace{50pt} k_i=2,k_j=3 \\
            \dec(k_4,\dec(k_3,\ct)) \hspace{50pt} k_i=3,k_j=4
        \end{cases}$$
    
    \noindent\textbf{Correctness:} Correctness of the scheme can be checked easily
    
    \securitygame{Security Game}{Security Game for Problem 2}{\label{red:p2sg}}
    {
        \begin{itemize}
            \item \textbf{Challenge Phase:} Challenger picks $k_2, k_3 \gets \calK$. The adversary sends keys
                  $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$.
                  Challenger samples $b \gets \bit$, computes $\ct_{1,2} \gets \enct(k_1, k_2, m^b_{1,2}),\ct_{2,3} \gets \enct(k_2, k_3, m^b_{2,3}),\ct_{3,4} \gets \enct(k_3, k_4, m^b_{3,4})$.
            \item \textbf{Encryption Queries:} The adversary can make polynomially many encryption queries. Each query consists of a message $m$ and an index-pair $\{i, j\}\in\{\{1, 2\} , \{2, 3\} , \{3, 4\}\}$. The challenger computes $\ct \gets \enct(k_i, k_j , m)$ and sends to the adversary.
            \item \textbf{Guess:} Finally, the adversary sends its guess $b'$ and wins if $b = b'$.
        \end{itemize}
    }

    \noindent\textbf{Security:} If $(\enc,\dec)$ is CPA secure, then no p.p.t. adversary has non-negligible advantage in the security game defined above.

    The proof is by a hybrid argument. Consider the following worlds which differ in only the challenge phase with respect to the above security game.
    \clearpage
    \begin{world}[World 0]
        \begin{itemize}
            \item Challenger picks $k_2, k_3 \gets \calK$. The adversary sends keys $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$. Challenger computes
                  $$\ct_{1,2} \gets \enct(k_1, k_2, m^0_{1,2}),\ct_{2,3} \gets \enct(k_2, k_3, m^0_{2,3}),\ct_{3,4} \gets \enct(k_3, k_4, m^0_{3,4})$$ and sends $(\ct_{1,2},\ct_{2,3},ct_{3,4})$ to the adversary.
        \end{itemize}
    \end{world}

    \begin{world}[Hybrid World 0]
        \begin{itemize}
            \item Challenger picks $k_2, k_3 \gets \calK$. The adversary sends keys $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$. Challenger computes
                  $$\ct_{1,2} \gets \enct(k_1, k_2, m^1_{1,2}),\ct_{2,3} \gets \enct(k_2, k_3, m^0_{2,3}),\ct_{3,4} \gets \enct(k_3, k_4, m^0_{3,4})$$ and sends $(\ct_{1,2},\ct_{2,3},ct_{3,4})$ to the adversary.
        \end{itemize}
    \end{world}

    \begin{world}[Hybrid World 1]
        \begin{itemize}
            \item Challenger picks $k_2, k_3 \gets \calK$. The adversary sends keys $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$. Challenger computes
                  $$\ct_{1,2} \gets \enct(k_1, k_2, m^1_{1,2}),\ct_{2,3} \gets \enct(k_2, k_3, m^1_{2,3}),\ct_{3,4} \gets \enct(k_3, k_4, m^0_{3,4})$$ and sends $(\ct_{1,2},\ct_{2,3},ct_{3,4})$ to the adversary.
        \end{itemize}
    \end{world}

    \begin{world}[World 1]
        \begin{itemize}
            \item Challenger picks $k_2, k_3 \gets \calK$. The adversary sends keys $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$. Challenger computes
                  $$\ct_{1,2} \gets \enct(k_1, k_2, m^1_{1,2}),\ct_{2,3} \gets \enct(k_2, k_3, m^1_{2,3}),\ct_{3,4} \gets \enct(k_3, k_4, m^1_{3,4})$$ and sends $(\ct_{1,2},\ct_{2,3},ct_{3,4})$ to the adversary.
        \end{itemize}
    \end{world}

    In subsequent worlds, the number of encryptions for $b=1$ increases. Let $p_0, p_{\hyb,0},  p_{\hyb,1}, p_1$ be the probabilities that the adversary outputs 0 in the above worlds.
    \clearpage

    \noindent\textbf{Claim:} If there exists an adversary $\calA$ for which $|p_0-p_{\hyb,0}|$ is non-negligible then there exists an adversary $\calB$ which breaks the CPA security of $\calE=(\enc,\dec)$ with advantage $|p_0-p_{\hyb,0}|$


    Consider the reduction \cref{red:p21}:
    \securitygame{Reduction}{Reduction 1 for Problem 2}{\label{red:p21}}
    {
        \begin{itemize}
            \item $\calA$ sends $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$ to $\calB$
            \item $\calB$ computes $x_0\gets\enc(k_1,m_{1,2}^0), x_1\gets\enc(k_1,m_{1,2}^1)$ and sends them to the challenger $\calC$ for $\calE$ to obtain $\ct = \enc(k_2,\enc(k_1,m^b_{1,2}))$. $\calB$ sets $\ct_{1,2}=\ct$
            \item $\calB$ samples $k_3\gets\calK$ and computes $x_3\gets\enc(k_3,m^0_{2,3})$. He then sends $(x_3,x_3)$ to $\calC$ to obtain $\ct'= \enc(k_2,\enc(k_3,m^0_{2,3}))$ and sets $\ct_{2,3}=\ct'$
            \item Next, $\calB$ computes $\ct_{3,4}\gets\enc(k_3,\enc(k_4,m^0_{3,4}))$ 
            \item $\calB$ sends $(\ct_{1,2}, \ct_{2,3}, \ct_{3,4})$ to $\calA$
            \item For the encryption queries, $\calB$ follows a similar procedure as above.
            \item Finally $\calA$ outputs a bit $b'$ which $\calB$ forwards to $\calC$
        \end{itemize}
    }
    
    If $\calC$ chooses $b$ to be 0 then the above reduction corresponds to World 0  while if he chooses 1, then it corresponds to Hybrid World 0. So the CPA advantage of $\calB=|p_0-p_{\hyb,0}|$
    \begin{figure}[!ht]
        \centering
        \includegraphics[scale=0.25]{images/Reduction21.jpg}
        \caption{Reduction 1 for Problem 2}
        \label{fig:p21}
    \end{figure}


    \clearpage

    \noindent\textbf{Claim:} If there exists an adversary $\calA$ for which $|p_{\hyb,0}-p_{\hyb,1}|$ is non-negligible then there exists an adversary $\calB$ which breaks the CPA security of $\calE=(\enc,\dec)$ with advantage $|p_{\hyb,0}-p_{\hyb,1}|$


    Consider the reduction \cref{red:p22}:
    \securitygame{Reduction}{Reduction 2 for Problem 2}{\label{red:p22}}
    {
        \begin{itemize}
            \item $\calA$ sends $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$ to $\calB$
            \item $\calB$ samples $k_2\gets\calK$ and computes $\ct_{1,2}\gets\enc(k_2,\enc(k_1,m^1_{1,2}))$. 
            \item $\calB$ sends $m^0_{2,3}, m^1_{2,3}$ to $\calC$ to obtain $\ct=\enc(k_3,m_{2,3}^b)$ and sets $\ct_{2,3}\gets\enc(k_2,\ct)$
            \item $\calB$ computes $x_0\gets\enc(k_4,m_{3,4}^0)$ and sends $(x_0,x_0)$ to $\calC$ to obtain $\ct' = \enc(k_3,\enc(k_4,m^0_{3,4}))$. $\calB$ sets $\ct_{3,4}=\ct'$
            \item $\calB$ sends $(\ct_{1,2}, \ct_{2,3}, \ct_{3,4})$ to $\calA$
            \item For the encryption queries, $\calB$ follows a similar procedure as above.
            \item Finally $\calA$ outputs a bit $b'$ which $\calB$ forwards to $\calC$
        \end{itemize}
    }
    
    If $\calC$ chooses $b$ to be 0 then the above reduction corresponds to Hybrid World 0  while if he chooses 1, then it corresponds to Hybrid World 1. So the CPA advantage of $\calB=|p_{\hyb,0}-p_{\hyb,1}|$
    \begin{figure}[!ht]
        \centering
        \includegraphics[scale=0.25]{images/Reduction22.jpg}
        \caption{Reduction 2 for Problem 2}
        \label{fig:p22}
    \end{figure}

    \clearpage

    \noindent\textbf{Claim:} If there exists an adversary $\calA$ for which $|p_{\hyb,1}-p_1|$ is non-negligible then there exists an adversary $\calB$ which breaks the CPA security of $\calE=(\enc,\dec)$ with advantage $|p_{\hyb,1}-p_1|$


    Consider the reduction:
    \securitygame{Reduction}{Reduction 3 for Problem 2}{\label{red:p23}}
    {
        \begin{itemize}
            \item $\calA$ sends $k_1, k_4$, as well as challenge messages $(m^0_{1,2}, m^0_{2,3},m^0_{3,4})$ and $(m^1_{1,2}, m^1_{2,3},m^1_{3,4})$ to $\calB$
            \item $\calB$ samples $k_2\gets\calK$ and computes $\ct_{1,2}\gets\enc(k_2,\enc(k_1,m^1_{1,2}))$. 
            \item $\calB$ sends $m^1_{2,3}, m^1_{2,3}$ to $\calC$ to obtain $\ct=\enc(k_3,m_{2,3}^1)$ and sets $\ct_{2,3}\gets\enc(k_2,\ct)$
            \item $\calB$ computes $x_0\gets\enc(k_4,m_{3,4}^0), x_1\gets\enc(k_4,m_{3,4}^1)$ and sends $(x_0,x_1)$ to $\calC$ to obtain $\ct' = \enc(k_3,\enc(k_4,m^b_{3,4}))$. $\calB$ sets $\ct_{3,4}=\ct'$
            \item $\calB$ sends $(\ct_{1,2}, \ct_{2,3}, \ct_{3,4})$ to $\calA$
            \item For the encryption queries, $\calB$ follows a similar procedure as above.
            \item Finally $\calA$ outputs a bit $b'$ which $\calB$ forwards to $\calC$
        \end{itemize}
    }

    If $\calC$ chooses $b$ to be 0 then the above reduction corresponds to Hybrid World 1  while if he chooses 1, then it corresponds to World 1. So the CPA advantage of $\calB=|p_{\hyb,1}-p_{1}|$
    
    \begin{figure}[!ht]
        \centering
        \includegraphics[scale=0.25]{images/Reduction23.jpg}
        \caption{Reduction 3 for Problem 2}
        \label{fig:p23}
    \end{figure}

    Thus from the above three claims, we can conclude that if $(\enc,\dec)$ is CPA secure, then no p.p.t. adversary has non-negligible advantage in the security game defined above.
\end{solution}

\prob{3 : One-time secure MACs, and Upgrading One-Time MACs to
    Many-Time MACs}
\begin{solution}

\end{solution}


\prob{4 : CCA Security v/s Authenticated Encryption}
\begin{solution}

\end{solution}

\prob{5: Modular Arithmetic and Basic Group Theory}
\begin{solution}
    \begin{enumerate}[(a)]
        \item Since $a$ and $p$ are coprime, by the Extended Euclid's Agorithm:
              $$ ab+py=\gcd(a,p)=1    $$
              Taking modulo p on both sides:
              $$ ab \mod p =1    $$
              Where $b\in\Z_p$ (If not then by the division algorithm $b=qp+b', b'<p$. So, we can replace $b$ with $b'$)
              \vspace{20pt}

              Now suppose there exist $b, b'\in\Z_p$ such that
              $$ ab=1\mod p \hspace{50pt} ab'=1\mod p    $$
              Then by definition of mod, $p|a(b-b')$. So $b-b'=0$ since $a$ and $b-b'$ will be coprime to $p$. Hence $b$ is unique.

        \item Consider $h(y)=y^2+y$ and $n=6$. For 3 values of $y$ viz. $2,3,5$, we have $h(y)=0\mod 6$. Thus
              $$|\{y\in\Z_6:y^2+y=0\mod6\}|=3>2$$

        \item Let $a\in\Z_p$ and $r=\ord(a)$. Then $a^r=1\mod p$. By Fermat's Little Theorem:
              $$a^{p-1}=1\mod p$$
              Suppose by the division algorithm, $p-1=rq+s$, $s<r$. Since $a^{p-1}=1\mod p$ and $a^{r}=1\mod p$, $$a^{p-1-rq}=1\mod p$$ and hence $a^{s}=1\mod p$. But since $s<r$, $s$ must be 0.
    \end{enumerate}
\end{solution}

\end{document}
